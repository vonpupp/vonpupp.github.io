{"author":{"name":"Albert","type":"card","url":"https://albertdelafuente.com"},"children":[{"content":{"html":"\n\n\u003cdiv class=\"ox-hugo-toc toc\"\u003e\n\n\u003cdiv class=\"heading\"\u003eTable of Contents\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#optional--create-a-boot-flash-disk-using-android\"\u003e(OPTIONAL) Create a boot flash disk using android\u003c/a\u003e\n    - \u003ca href=\"#etchdroid-usb-writer-f-droid-free-and-open-source-android-app-repository\"\u003eEtchDroid USB writer | F-Droid - Free and Open Source Android App Repository\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mounting-and-chrooting-the-system\"\u003eMounting and chrooting the system\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#edit-the-etc-default-grub-file\"\u003eEdit the /etc/default/grub file\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#config-and-install-grub-and-create-the-ramdisk\"\u003eConfig and install GRUB and create the ramdisk\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#references\"\u003eReferences\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#solved-grub-with-lvm-on-luks-rescue-mode-dot-incomplete-grub-dot-cfg-installation-arch-linux-forums\"\u003e[SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003c/div\u003e\n\u003c!--endtoc--\u003e\u003c/p\u003e\n\n\u003cp\u003eRecently an upgrade on my notebook went bad and broke something. I wasn\u0026rsquo;t sure\nwhat went wrong but since I had just one system at that time, I had to figure\nout how to fix it with the help of my phone. Basically what I did is install\nEtchDroid to be able to download an iso and flash it to a flash drive on my\nphone directly. Later I could boot form that flash drive, mount the LUKS/LVM\npartitions and fix the bootloader. Here is a short how to.\u003c/p\u003e\n\n\u003ch2 id=\"optional--create-a-boot-flash-disk-using-android\"\u003e(OPTIONAL) Create a boot flash disk using android\u003c/h2\u003e\n\n\u003ch4 id=\"etchdroid-usb-writer-f-droid-free-and-open-source-android-app-repository\"\u003e\u003ca href=\"https://f-droid.org/en/packages/eu.depau.etchdroid/\"\u003eEtchDroid USB writer | F-Droid - Free and Open Source Android App Repository\u003c/a\u003e\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eSource: \u003ca href=\"https://f-droid.org/en/packages/eu.depau.etchdroid/\"\u003ehttps://f-droid.org/en/packages/eu.depau.etchdroid/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eTitle: EtchDroid USB writer | F-Droid - Free and Open Source Android App Repository\u003c/li\u003e\n\u003cli\u003eCaptured on: \u003cspan class=\"timestamp-wrapper\"\u003e\u003cspan class=\"timestamp\"\u003e[2021-08-05 Thu]\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"mounting-and-chrooting-the-system\"\u003eMounting and chrooting the system\u003c/h2\u003e\n\n\u003cp\u003e#+begin_src sh\u003c/p\u003e\n\n\u003cp\u003ecryptsetup luksOpen /dev/disk/by-partlabel/cryptlvm lvm\u003c/p\u003e\n\n\u003cp\u003emount /dev/storage/root /mnt\nmount /dev/storage/home /mnt/home\u003c/p\u003e\n\n\u003cp\u003emount /dev/sda1 /mnt/boot\u003c/p\u003e\n\n\u003cp\u003ecd \u003cem\u003emnt\nmount -t proc /proc proc\u003c/em\u003e\n#mount -t sysfs \u003cem\u003esys sys\u003c/em\u003e\n#mount -o bind \u003cem\u003edev dev\u003c/em\u003e\nmount -o bind \u003cem\u003erun run\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003earch-chroot /mnt\u003c/p\u003e\n\n\u003cp\u003edhcpcd eth0\n#+end_src sh\u003c/p\u003e\n\n\u003ch2 id=\"edit-the-etc-default-grub-file\"\u003eEdit the /etc/default/grub file\u003c/h2\u003e\n\n\u003cp\u003e#+begin_src sh\u003c/p\u003e\n\n\u003cp\u003eGRUB_CMDLINE_LINUX=\u0026ldquo;cryptdevice=/dev/sda2:lvm\u0026rdquo;\n  GRUB_PRELOAD_MODULES=\u0026ldquo;part_gpt part_msdos cryptodisk luks\u0026rdquo;\n#+end_src sh\u003c/p\u003e\n\n\u003ch2 id=\"config-and-install-grub-and-create-the-ramdisk\"\u003eConfig and install GRUB and create the ramdisk\u003c/h2\u003e\n\n\u003cp\u003e#+begin_src sh\u003c/p\u003e\n\n\u003cp\u003egrub-mkconfig \u0026gt; /boot/grub/grub.cfg\ngrub-install \u0026ndash;efi-directory=/boot \u0026ndash;target=x86_64-efi /dev/sda\u003c/p\u003e\n\n\u003cp\u003emkinitcpio -p linux\n#+end_src sh\u003c/p\u003e\n\n\u003ch2 id=\"references\"\u003eReferences\u003c/h2\u003e\n\n\u003ch3 id=\"solved-grub-with-lvm-on-luks-rescue-mode-dot-incomplete-grub-dot-cfg-installation-arch-linux-forums\"\u003e\u003ca href=\"https://bbs.archlinux.org/viewtopic.php?id=246628\"\u003e[SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums\u003c/a\u003e\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eSource: \u003ca href=\"https://bbs.archlinux.org/viewtopic.php?id=246628\"\u003ehttps://bbs.archlinux.org/viewtopic.php?id=246628\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eTitle: [SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums\u003c/li\u003e\n\u003cli\u003eCaptured on: \u003cspan class=\"timestamp-wrapper\"\u003e\u003cspan class=\"timestamp\"\u003e[2021-08-04 Wed]\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","text":" Table of Contents  (OPTIONAL) Create a boot flash disk using android - EtchDroid USB writer | F-Droid - Free and Open Source Android App Repository Mounting and chrooting the system Edit the /etc/default/grub file Config and install GRUB and create the ramdisk References  [SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums    \nRecently an upgrade on my notebook went bad and broke something. I wasn\u0026rsquo;t sure what went wrong but since I had just one system at that time, I had to figure out how to fix it with the help of my phone. Basically what I did is install EtchDroid to be able to download an iso and flash it to a flash drive on my phone directly. Later I could boot form that flash drive, mount the LUKS/LVM partitions and fix the bootloader. Here is a short how to.\n(OPTIONAL) Create a boot flash disk using android EtchDroid USB writer | F-Droid - Free and Open Source Android App Repository  Source: https://f-droid.org/en/packages/eu.depau.etchdroid/ Title: EtchDroid USB writer | F-Droid - Free and Open Source Android App Repository Captured on: [2021-08-05 Thu]  Mounting and chrooting the system #+begin_src sh\ncryptsetup luksOpen /dev/disk/by-partlabel/cryptlvm lvm\nmount /dev/storage/root /mnt mount /dev/storage/home /mnt/home\nmount /dev/sda1 /mnt/boot\ncd mnt mount -t proc /proc proc #mount -t sysfs sys sys #mount -o bind dev dev mount -o bind run run\narch-chroot /mnt\ndhcpcd eth0 #+end_src sh\nEdit the /etc/default/grub file #+begin_src sh\nGRUB_CMDLINE_LINUX=\u0026ldquo;cryptdevice=/dev/sda2:lvm\u0026rdquo; GRUB_PRELOAD_MODULES=\u0026ldquo;part_gpt part_msdos cryptodisk luks\u0026rdquo; #+end_src sh\nConfig and install GRUB and create the ramdisk #+begin_src sh\ngrub-mkconfig \u0026gt; /boot/grub/grub.cfg grub-install \u0026ndash;efi-directory=/boot \u0026ndash;target=x86_64-efi /dev/sda\nmkinitcpio -p linux #+end_src sh\nReferences [SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums  Source: https://bbs.archlinux.org/viewtopic.php?id=246628 Title: [SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums Captured on: [2021-08-04 Wed]  "},"name":"How to recover a GRUB bootloader on a filesystem with LUKS and LVM","published":"2021-08-04T00:00:00-03:00","summary":"Table of Contents  (OPTIONAL) Create a boot flash disk using android - EtchDroid USB writer | F-Droid - Free and Open Source Android App Repository Mounting and chrooting the system Edit the /etc/default/grub file Config and install GRUB and create the ramdisk References  [SOLVED] Grub with lvm on LUKS -\u0026gt; rescue mode. Incomplete grub.cfg? / Installation / Arch Linux Forums    \nRecently an upgrade on my notebook went bad and broke something.","type":"entry","url":"https://albertdelafuente.com/posts/20210804193727-how_to_recover_grub_with_luks_and_lvm/"},{"content":{"html":"\n\n\u003cp\u003eI have been using LVM on top of LUKS for more than 2 years without problems.\nHowever since I haven\u0026rsquo;t had the chance to troubleshoot these technologies in\nthe past I was quite concerned of what would happen when I would have problems.\nToday my main computer didn\u0026rsquo;t boot up and I had to fix it manually. This\npost shows the steps I performed to recover my system.\u003c/p\u003e\n\n\u003cp\u003eI use Arch Linux and I prepared a repository with my custom install method\nbased on archinstaller. Basically I have a custom partitioning based on LVM on\ntop of LUKS and some variables to start he installing method.\u003c/p\u003e\n\n\u003cp\u003eHere is an overview of the parts on this tutorial:\u003c/p\u003e\n\n\u003ch2 id=\"tutorial-overview\"\u003eTutorial overview\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a bootable USB and boot the broken system with it (AKA recovery mode**\u003c/li\u003e\n\u003cli\u003eChroot into the system\u003c/li\u003e\n\u003cli\u003eFix the issue\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"assumptions\"\u003eAssumptions\u003c/h2\u003e\n\n\u003cp\u003eI will assume that the error is similar as mine. After opening the LUKS device,\nI had the following problem:\n\u003ccode\u003eERROR: device /dev/mapper/storage-root not found\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"create-a-bootable-usb\"\u003eCreate a bootable USB\u003c/h2\u003e\n\n\u003cp\u003eTo create a bootable USB you need to download the latest Arch Linux iso and\nthen us \u003ccode\u003edd\u003c/code\u003e to dump it to a flash drive.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edd \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e4M \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/path/to/archlinux.iso \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/sdx \u003cspan class=\"nv\"\u003estatus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eprogress \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sync\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter completion, use the same flash drive to boot the broken computer. You\ngenerally need to hit a key on the \u003ccode\u003eF5\u003c/code\u003e - \u003ccode\u003eF6\u003c/code\u003e range to choose the boot method.\u003c/p\u003e\n\n\u003ch2 id=\"chroot-into-the-system\"\u003eChroot into the system\u003c/h2\u003e\n\n\u003cp\u003eOnce the system has booted, now we need to mount everything the system would\nmount on a boot stage.  Adapt the LUKS label and LVM devices according to your\nneeds.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# Open the LUKS device.\u003c/span\u003e\ncryptsetup luksOpen /dev/disk/by-partlabel/cryptlvm lvm\n\n\u003cspan class=\"c1\"\u003e# Mount the root partition\u003c/span\u003e\nmount /dev/storage/root /mnt\n\n\u003cspan class=\"c1\"\u003e# Mount the boot partition\u003c/span\u003e\nmount /dev/sda1 /mnt/boot\n\n\u003cspan class=\"c1\"\u003e# Mount proc, sys and dev\u003c/span\u003e\nmount -t proc proc proc/\nmount -t sysfs sys sys/\nmount -o \u003cspan class=\"nb\"\u003ebind\u003c/span\u003e /dev dev/\n\n\u003cspan class=\"c1\"\u003e# Switch to bash\u003c/span\u003e\nbash\n\n\u003cspan class=\"c1\"\u003e# Chroot\u003c/span\u003e\nchroot /mnt\n\n\u003cspan class=\"c1\"\u003e# Bring up network if needed\u003c/span\u003e\ndhcpcd eth0\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt this point you should have shell with a recovery environment set to fix the\nissue, so let\u0026rsquo;s fix it.\u003c/p\u003e\n\n\u003ch2 id=\"fix-the-issue\"\u003eFix the issue\u003c/h2\u003e\n\n\u003cp\u003eTo fix the issue we basically are going to perform an upgrade an recreate the\ninitial ramdisk\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# Update the packages database\u003c/span\u003e\npacman -Syy\n\n\u003cspan class=\"c1\"\u003e# Upgrade the packages\u003c/span\u003e\npacman -Syu\n\n\u003cspan class=\"c1\"\u003e# Update udev package\u003c/span\u003e\npacman -S udev\n\n\u003cspan class=\"c1\"\u003e# Update mkinitcpio package\u003c/span\u003e\npacman -S mkinitcpio\n\n\u003cspan class=\"c1\"\u003e# Recreate the initial ramdisk\u003c/span\u003e\nmkinitcpio -p linux\n\n\u003cspan class=\"c1\"\u003e# Exit the chroot environment\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexit\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# Reboot\u003c/span\u003e\nreboot\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf everything went well, you now should be able to boot the system properly.\u003c/p\u003e\n\n\u003ch2 id=\"conclusions\"\u003eConclusions\u003c/h2\u003e\n\n\u003cp\u003eI was quite worried about how to solve this issue due to the several layers of\ncomplexity: GPT, LUKS and LVM, however everything went out quite smoothly. The\nkey part is to use a USB flash drive and then mount the boot and root\npartitions to recreate the ramdisk.\u003c/p\u003e\n\n\u003cp\u003eThanks for reading. Spot an error or want to explain something better, feel\nfree to send me a PR.\u003c/p\u003e\n","text":" I have been using LVM on top of LUKS for more than 2 years without problems. However since I haven\u0026rsquo;t had the chance to troubleshoot these technologies in the past I was quite concerned of what would happen when I would have problems. Today my main computer didn\u0026rsquo;t boot up and I had to fix it manually. This post shows the steps I performed to recover my system.\nI use Arch Linux and I prepared a repository with my custom install method based on archinstaller. Basically I have a custom partitioning based on LVM on top of LUKS and some variables to start he installing method.\nHere is an overview of the parts on this tutorial:\nTutorial overview  Create a bootable USB and boot the broken system with it (AKA recovery mode** Chroot into the system Fix the issue  Assumptions I will assume that the error is similar as mine. After opening the LUKS device, I had the following problem: ERROR: device /dev/mapper/storage-root not found.\nCreate a bootable USB To create a bootable USB you need to download the latest Arch Linux iso and then us dd to dump it to a flash drive.\ndd bs=4M if=/path/to/archlinux.iso of=/dev/sdx status=progress \u0026amp;\u0026amp; sync After completion, use the same flash drive to boot the broken computer. You generally need to hit a key on the F5 - F6 range to choose the boot method.\nChroot into the system Once the system has booted, now we need to mount everything the system would mount on a boot stage. Adapt the LUKS label and LVM devices according to your needs.\n# Open the LUKS device. cryptsetup luksOpen /dev/disk/by-partlabel/cryptlvm lvm # Mount the root partition mount /dev/storage/root /mnt # Mount the boot partition mount /dev/sda1 /mnt/boot # Mount proc, sys and dev mount -t proc proc proc/ mount -t sysfs sys sys/ mount -o bind /dev dev/ # Switch to bash bash # Chroot chroot /mnt # Bring up network if needed dhcpcd eth0 At this point you should have shell with a recovery environment set to fix the issue, so let\u0026rsquo;s fix it.\nFix the issue To fix the issue we basically are going to perform an upgrade an recreate the initial ramdisk\n# Update the packages database pacman -Syy # Upgrade the packages pacman -Syu # Update udev package pacman -S udev # Update mkinitcpio package pacman -S mkinitcpio # Recreate the initial ramdisk mkinitcpio -p linux # Exit the chroot environment exit # Reboot reboot If everything went well, you now should be able to boot the system properly.\nConclusions I was quite worried about how to solve this issue due to the several layers of complexity: GPT, LUKS and LVM, however everything went out quite smoothly. The key part is to use a USB flash drive and then mount the boot and root partitions to recreate the ramdisk.\nThanks for reading. Spot an error or want to explain something better, feel free to send me a PR.\n"},"name":"How to manually boot/recover a system with LUKS and LVM","published":"2016-11-22T00:00:00-02:00","summary":"I have been using LVM on top of LUKS for more than 2 years without problems. However since I haven\u0026rsquo;t had the chance to troubleshoot these technologies in the past I was quite concerned of what would happen when I would have problems. Today my main computer didn\u0026rsquo;t boot up and I had to fix it manually. This post shows the steps I performed to recover my system.\nI use Arch Linux and I prepared a repository with my custom install method based on archinstaller.","type":"entry","url":"https://albertdelafuente.com/posts/20220109212259-how_to_manually_boot_recover_a_system_with_luks_and_lvm/"},{"content":{"html":"\n\n\u003cp\u003ePublishing keys is quite common. One nice way to do so is by using the Public\nKey Association (PKA) DNS record. Basically this is a record that points to a\nfile that can be downloaded over the internet. This method is an alternative\n(not exclusive) to using keyservers.\u003c/p\u003e\n\n\u003cp\u003eOne of the problems of keyservers (in my opinion), is the problem of deleting\nold keys. I pretty much like the idea of PGP keyserver which verifies\nperiodically by sending an email if the address is still in use and therefore\nmaintain that \u003ccode\u003euid\u003c/code\u003e of the key. The only problem is that the PGP server is\ncentralized and it does not use FLOSS standards.\u003c/p\u003e\n\n\u003cp\u003eI understand that deleting a key on a distributed environment is hard and\nprobably maintaining a history of deletions as done actually on most of\nkeyservers is still a good solution. However since I don\u0026rsquo;t use GPG very often\nand I am not publishing my key yet, I wanted to try PKA.\u003c/p\u003e\n\n\u003cp\u003eThis tutorial is made of two basic parts, first creating a TXT DNS record and\nthen verifying that the key gets downloaded properly.\u003c/p\u003e\n\n\u003ch3 id=\"tutorial-overview\"\u003eTutorial overview\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eCreating the TXT DNS record\u003c/li\u003e\n\u003cli\u003eTesting the PKA record\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"assumptions\"\u003eAssumptions\u003c/h2\u003e\n\n\u003cp\u003eI assume that you have gpg installed and that you know the basic idea on how it\nworks, that you know what a private and a public keys are for and how to use\nthem.\u003c/p\u003e\n\n\u003ch2 id=\"creating-the-txt-dns-record\"\u003eCreating the TXT DNS record\u003c/h2\u003e\n\n\u003cp\u003eTo create the TXT DNS record you will need to know the fingerprint of the key.\nTo do so:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e$ gpg --list-keys vonpupp@keybase.io\npub   rsa2048/0x536814BF4871A220 \u003cspan class=\"m\"\u003e2016\u003c/span\u003e-11-12 \u003cspan class=\"o\"\u003e[\u003c/span\u003eSC\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eexpires: \u003cspan class=\"m\"\u003e2018\u003c/span\u003e-11-12\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n      Key \u003cspan class=\"nv\"\u003efingerprint\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e F0B9 B3FB 25E9 \u003cspan class=\"m\"\u003e1209\u003c/span\u003e 728E  \u003cspan class=\"m\"\u003e4844\u003c/span\u003e \u003cspan class=\"m\"\u003e5368\u003c/span\u003e 14BF \u003cspan class=\"m\"\u003e4871\u003c/span\u003e A220\n      uid                   \u003cspan class=\"o\"\u003e[\u003c/span\u003eultimate\u003cspan class=\"o\"\u003e]\u003c/span\u003e Albert De La Fuente \u0026lt;vonpupp@keybase.io\u0026gt;\n      uid                   \u003cspan class=\"o\"\u003e[\u003c/span\u003eultimate\u003cspan class=\"o\"\u003e]\u003c/span\u003e Albert De La Fuente \u003cspan class=\"o\"\u003e(\u003c/span\u003eSocial email address\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u0026lt;vonpupp@gmail.com\u0026gt;\n      uid                   \u003cspan class=\"o\"\u003e[\u003c/span\u003eultimate\u003cspan class=\"o\"\u003e]\u003c/span\u003e Albert De La Fuente \u003cspan class=\"o\"\u003e(\u003c/span\u003eMain email address\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u0026lt;mail@albertdelafuente.com\u0026gt;\n      uid                   \u003cspan class=\"o\"\u003e[\u003c/span\u003eultimate\u003cspan class=\"o\"\u003e]\u003c/span\u003e Albert De La Fuente \u003cspan class=\"o\"\u003e(\u003c/span\u003eHaevas email address\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u0026lt;albert@haevas.com\u0026gt;\n      uid                   \u003cspan class=\"o\"\u003e[\u003c/span\u003eultimate\u003cspan class=\"o\"\u003e]\u003c/span\u003e Albert De La Fuente \u003cspan class=\"o\"\u003e(\u003c/span\u003eAcademic email address\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u0026lt;albert@ime.usp.br\u0026gt;\n      sub   rsa2048/0xE2977BF3F82AB971 \u003cspan class=\"m\"\u003e2016\u003c/span\u003e-11-12 \u003cspan class=\"o\"\u003e[\u003c/span\u003eE\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eexpires: \u003cspan class=\"m\"\u003e2018\u003c/span\u003e-11-12\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn my case, the fingerprint is \u003cstrong\u003eF0B9 B3FB 25E9 1209 728E  4844 5368 14BF 4871\nA220\u003c/strong\u003e, or \u003cstrong\u003e0x536814BF4871A220\u003c/strong\u003e for short.\u003c/p\u003e\n\n\u003cp\u003eThen you need to export the key with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e$ gpg --export -a 0x536814BF4871A220 \u0026gt; public-0x536814BF4871A220.asc\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen create a TXT record where:\u003c/p\u003e\n\n\u003ch2 id=\"the-name-part\"\u003eThe \u003ccode\u003eName\u003c/code\u003e part:\u003c/h2\u003e\n\n\u003cp\u003eIs composed of \u003ccode\u003emailbox\u003c/code\u003e._pka.albertdelafuente.com. So for\ninstance if my email is \u003ccode\u003elong-anti-spam-email-address@albertdelafuentedotcom\u003c/code\u003e,\nthen the name part should be\n\u003ccode\u003elong-anti-spam-email-address._pka.albertdelafuente.com\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"the-text-data\"\u003eThe \u003ccode\u003eText\u003c/code\u003e data:\u003c/h2\u003e\n\n\u003cp\u003eContains the \u003ccode\u003efingerprint\u003c/code\u003e and the \u003ccode\u003eURL\u003c/code\u003e where to download the key. In my case:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;v=pka1;fpr=F0B9B3FB25E91209728E4844536814BF4871A220;uri=http://albertdelafuente.com/media/files/public-0x536814BF4871A220.asc\u0026#34;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eDo not forget to upload the key to match the \u003ccode\u003euri\u003c/code\u003e as on the TXT record. In my case:\n\u003ca href=\"http://albertdelafuente.com/media/files/public-0x536814BF4871A220.asc\"\u003ehttp://albertdelafuente.com/media/files/public-0x536814BF4871A220.asc\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"testing-the-pka-record\"\u003eTesting the PKA record\u003c/h2\u003e\n\n\u003cp\u003eOnce done that you can download the key (just for testing purposes) on another computer or VM as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Test message\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e gpg --auto-key-locate pka -ear mail@albertdelafuente.com\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn my case this will prompt you with a confirmation since my primary uid does\nnot match the email. This is made in purpose because I have read that some\nspammers are using keyservers to get valid email addresses, therefore I always\nuse keybase as my primary id.\u003c/p\u003e\n\n\u003cp\u003eYou will see something similar to this as the output:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egpg: \u003cspan class=\"nv\"\u003edirectory\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e/home/vagrant/.gnupg\u003cspan class=\"s1\"\u003e\u0026#39; created\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: new configuration file =/home/vagrant/.gnupg/gpg.conf\u0026#39;\u003c/span\u003e created\ngpg: WARNING: options \u003cspan class=\"nv\"\u003ein\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e/home/vagrant/.gnupg/gpg.conf\u003cspan class=\"s1\"\u003e\u0026#39; are not yet active during this run\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: keyring =/home/vagrant/.gnupg/secring.gpg\u0026#39;\u003c/span\u003e created\ngpg: \u003cspan class=\"nv\"\u003ekeyring\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e/home/vagrant/.gnupg/pubring.gpg\u003cspan class=\"s1\"\u003e\u0026#39; created\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: requesting key 4871A220 from http server albertdelafuente.com\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: /home/vagrant/.gnupg/trustdb.gpg: trustdb created\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: key 4871A220: public key \u0026#34;Albert De La Fuente \u0026lt;vonpupp@keybase.io\u0026gt;\u0026#34; imported\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: Total number processed: 1\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg:               imported: 1  (RSA: 1)\n\u003c/span\u003e\u003cspan class=\"s1\"\u003egpg: automatically retrieved =mail@albertdelafuente.com\u0026#39;\u003c/span\u003e via PKA\ngpg: F82AB971: There is no assurance this key belongs to the named user\n\npub  2048R/F82AB971 \u003cspan class=\"m\"\u003e2016\u003c/span\u003e-11-12 Albert De La Fuente \u0026lt;vonpupp@keybase.io\u0026gt;\n Primary key fingerprint: F0B9 B3FB 25E9 \u003cspan class=\"m\"\u003e1209\u003c/span\u003e 728E  \u003cspan class=\"m\"\u003e4844\u003c/span\u003e \u003cspan class=\"m\"\u003e5368\u003c/span\u003e 14BF \u003cspan class=\"m\"\u003e4871\u003c/span\u003e A220\n      Subkey fingerprint: 7A10 07B4 3F49 \u003cspan class=\"m\"\u003e5317\u003c/span\u003e 5DE0  52E8 E297 7BF3 F82A B971\n\nIt is NOT certain that the key belongs to the person named\nin the user ID.  If you *really* know what you are doing,\nyou may answer the next question with yes.\n\nUse this key anyway? \u003cspan class=\"o\"\u003e(\u003c/span\u003ey/N\u003cspan class=\"o\"\u003e)\u003c/span\u003e y\n-----BEGIN PGP MESSAGE-----\nVersion: GnuPG v1\n\nhQEMA+KXe/P4KrlxAQf/d1yxYFBSPs0RKHJ98w+s82jK25R/IXCiFNe6BkX+oyp+\nuh+4AObx93SuJ/ryHlthHQmnpid4BQWmhmCksiAH+xD1xrlrCDIsNQfJ5+aPQXjz\n+Z6iKrWy8Lk13i6u3wgMZuk2eKN9Z1ppi15arXhFc93cta5p5K5tAH7CwMd5zP93\nr7wgI2Jff+x3erN0zbkJ2PZgDrHZVLVWyOnwgRBw12N8El3L8i6JFbNY+g25AMUm\nMMCPSTit8ILsFoPtkrJEOdq5p5aCw3dvIVSzmxflMJEsgqO+Per+KxtMehaBF5qX\nI2TzltcgjlisSJ3rcBtjpm12rSVJrPs4BG2UKz0w6tJIAbF0FLlWXe8zMJMK1E3Q\nBQ7y/gjTduiuuD++qyIxqWCoLCgHixvP4WiTPbbKvoXl4BP8Bf1ED9M/0Cyss2NI\n\u003cspan class=\"nv\"\u003etW7vVlLcXRQb\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u003c/span\u003egdKa\n-----END PGP MESSAGE-----\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"conclusions\"\u003eConclusions\u003c/h2\u003e\n\n\u003cp\u003eAs you can see it is not that hard to publish a public key via DNS. You need to\nexport your key to a file and upload it and then create a TXT record relating\nthe fingerprint and the location of the key. You may also publish your key on a\nkeyserver also since not everybody retrieve the keys over DNS.\u003c/p\u003e\n\n\u003cp\u003eThanks for reading. Spot an error or want to explain something better, feel\nfree to send me a PR.\u003c/p\u003e\n","text":" Publishing keys is quite common. One nice way to do so is by using the Public Key Association (PKA) DNS record. Basically this is a record that points to a file that can be downloaded over the internet. This method is an alternative (not exclusive) to using keyservers.\nOne of the problems of keyservers (in my opinion), is the problem of deleting old keys. I pretty much like the idea of PGP keyserver which verifies periodically by sending an email if the address is still in use and therefore maintain that uid of the key. The only problem is that the PGP server is centralized and it does not use FLOSS standards.\nI understand that deleting a key on a distributed environment is hard and probably maintaining a history of deletions as done actually on most of keyservers is still a good solution. However since I don\u0026rsquo;t use GPG very often and I am not publishing my key yet, I wanted to try PKA.\nThis tutorial is made of two basic parts, first creating a TXT DNS record and then verifying that the key gets downloaded properly.\nTutorial overview  Creating the TXT DNS record Testing the PKA record  Assumptions I assume that you have gpg installed and that you know the basic idea on how it works, that you know what a private and a public keys are for and how to use them.\nCreating the TXT DNS record To create the TXT DNS record you will need to know the fingerprint of the key. To do so:\n$ gpg --list-keys vonpupp@keybase.io pub rsa2048/0x536814BF4871A220 2016-11-12 [SC] [expires: 2018-11-12] Key fingerprint = F0B9 B3FB 25E9 1209 728E 4844 5368 14BF 4871 A220 uid [ultimate] Albert De La Fuente \u0026lt;vonpupp@keybase.io\u0026gt; uid [ultimate] Albert De La Fuente (Social email address) \u0026lt;vonpupp@gmail.com\u0026gt; uid [ultimate] Albert De La Fuente (Main email address) \u0026lt;mail@albertdelafuente.com\u0026gt; uid [ultimate] Albert De La Fuente (Haevas email address) \u0026lt;albert@haevas.com\u0026gt; uid [ultimate] Albert De La Fuente (Academic email address) \u0026lt;albert@ime.usp.br\u0026gt; sub rsa2048/0xE2977BF3F82AB971 2016-11-12 [E] [expires: 2018-11-12] In my case, the fingerprint is F0B9 B3FB 25E9 1209 728E 4844 5368 14BF 4871 A220, or 0x536814BF4871A220 for short.\nThen you need to export the key with:\n$ gpg --export -a 0x536814BF4871A220 \u0026gt; public-0x536814BF4871A220.asc Then create a TXT record where:\nThe Name part: Is composed of mailbox._pka.albertdelafuente.com. So for instance if my email is long-anti-spam-email-address@albertdelafuentedotcom, then the name part should be long-anti-spam-email-address._pka.albertdelafuente.com.\nThe Text data: Contains the fingerprint and the URL where to download the key. In my case:\n\u0026#34;v=pka1;fpr=F0B9B3FB25E91209728E4844536814BF4871A220;uri=http://albertdelafuente.com/media/files/public-0x536814BF4871A220.asc\u0026#34; Do not forget to upload the key to match the uri as on the TXT record. In my case: http://albertdelafuente.com/media/files/public-0x536814BF4871A220.asc\nTesting the PKA record Once done that you can download the key (just for testing purposes) on another computer or VM as follows:\n$ echo \u0026#34;Test message\u0026#34; | gpg --auto-key-locate pka -ear mail@albertdelafuente.com In my case this will prompt you with a confirmation since my primary uid does not match the email. This is made in purpose because I have read that some spammers are using keyservers to get valid email addresses, therefore I always use keybase as my primary id.\nYou will see something similar to this as the output:\ngpg: directory =/home/vagrant/.gnupg\u0026#39; created gpg: new configuration file =/home/vagrant/.gnupg/gpg.conf\u0026#39; created gpg: WARNING: options in =/home/vagrant/.gnupg/gpg.conf\u0026#39; are not yet active during this run gpg: keyring =/home/vagrant/.gnupg/secring.gpg\u0026#39; created gpg: keyring =/home/vagrant/.gnupg/pubring.gpg\u0026#39; created gpg: requesting key 4871A220 from http server albertdelafuente.com gpg: /home/vagrant/.gnupg/trustdb.gpg: trustdb created gpg: key 4871A220: public key \u0026#34;Albert De La Fuente \u0026lt;vonpupp@keybase.io\u0026gt;\u0026#34; imported gpg: Total number processed: 1 gpg: imported: 1 (RSA: 1) gpg: automatically retrieved =mail@albertdelafuente.com\u0026#39; via PKA gpg: F82AB971: There is no assurance this key belongs to the named user pub 2048R/F82AB971 2016-11-12 Albert De La Fuente \u0026lt;vonpupp@keybase.io\u0026gt; Primary key fingerprint: F0B9 B3FB 25E9 1209 728E 4844 5368 14BF 4871 A220 Subkey fingerprint: 7A10 07B4 3F49 5317 5DE0 52E8 E297 7BF3 F82A B971 It is NOT certain that the key belongs to the person named in the user ID. If you *really* know what you are doing, you may answer the next question with yes. Use this key anyway? (y/N) y -----BEGIN PGP MESSAGE----- Version: GnuPG v1 hQEMA+KXe/P4KrlxAQf/d1yxYFBSPs0RKHJ98w+s82jK25R/IXCiFNe6BkX+oyp+ uh+4AObx93SuJ/ryHlthHQmnpid4BQWmhmCksiAH+xD1xrlrCDIsNQfJ5+aPQXjz +Z6iKrWy8Lk13i6u3wgMZuk2eKN9Z1ppi15arXhFc93cta5p5K5tAH7CwMd5zP93 r7wgI2Jff+x3erN0zbkJ2PZgDrHZVLVWyOnwgRBw12N8El3L8i6JFbNY+g25AMUm MMCPSTit8ILsFoPtkrJEOdq5p5aCw3dvIVSzmxflMJEsgqO+Per+KxtMehaBF5qX I2TzltcgjlisSJ3rcBtjpm12rSVJrPs4BG2UKz0w6tJIAbF0FLlWXe8zMJMK1E3Q BQ7y/gjTduiuuD++qyIxqWCoLCgHixvP4WiTPbbKvoXl4BP8Bf1ED9M/0Cyss2NI tW7vVlLcXRQb =gdKa -----END PGP MESSAGE----- Conclusions As you can see it is not that hard to publish a public key via DNS. You need to export your key to a file and upload it and then create a TXT record relating the fingerprint and the location of the key. You may also publish your key on a keyserver also since not everybody retrieve the keys over DNS.\nThanks for reading. Spot an error or want to explain something better, feel free to send me a PR.\n"},"name":"How to publish a GPG key via DNS","published":"2016-11-13T00:00:00-02:00","summary":"Publishing keys is quite common. One nice way to do so is by using the Public Key Association (PKA) DNS record. Basically this is a record that points to a file that can be downloaded over the internet. This method is an alternative (not exclusive) to using keyservers.\nOne of the problems of keyservers (in my opinion), is the problem of deleting old keys. I pretty much like the idea of PGP keyserver which verifies periodically by sending an email if the address is still in use and therefore maintain that uid of the key.","type":"entry","url":"https://albertdelafuente.com/posts/20220109212103-how_to_publish_a_gpg_key_via_dns/"},{"content":{"html":"\n\n\u003ch2 id=\"how-to-manually-boot-recover-a-system-with-luks-and-lvm\"\u003eHow to manually boot/recover a system with LUKS and LVM\u003c/h2\u003e\n\n\u003cp\u003eI have been using LVM on top of LUKS for more than 2 years without problems. However since I haven\u0026rsquo;t had the chance to troubleshoot these technologies in the past I was quite concerned of what would happen when I would have problems. Today my main computer didn\u0026rsquo;t boot up and I had to fix it manually. This post shows the steps I performed to recover my system.\u003c/p\u003e\n\n\u003ch3 id=\"intro\"\u003eIntro\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ecryptsetup luksOpen /dev/sda2 cryptlvm\n\ne2fsck -f /dev/mapper/storage-home\n\nresize2fs -p /dev/mapper/storage-home 200g\n\ne2fsck -f /dev/mapper/storage-home\n\n\u003cspan class=\"o\"\u003e(\u003c/span\u003elvdisplay\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nlvreduce -L -15.68G /dev/storage/home\n\u003cspan class=\"o\"\u003e(\u003c/span\u003elvdisplay\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003elvresize -l +100%FREE /dev/storate/root\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\ne2fsck -f /dev/mapper/storage-root\n\nresize2fs /dev/mapper/storage-root\n\ncryptsetup luksClose /dev/sda2 cryptlvm\n\n\n\u003cspan class=\"c1\"\u003e### NOT NEEDED\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e(\u003c/span\u003epvdisplay\u003cspan class=\"o\"\u003e)\u003c/span\u003e\npvresize --sephysicalvolumesize 218G /dev/mapper/cryptlvm\n\n/dev/mapper/cryptlvm is active and is in use\n  type:    LUKS1\n  cipher:  aes-xts-plain64\n  keysize: \u003cspan class=\"m\"\u003e256\u003c/span\u003e bits\n  device:  /dev/sda2\n  offset:  \u003cspan class=\"m\"\u003e4096\u003c/span\u003e sectors\n  size:    \u003cspan class=\"m\"\u003e487981391\u003c/span\u003e sectors\n  mode:    read/write\n\n\u003cspan class=\"nv\"\u003eNEW_SECTORS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e EXISTING_SECTORS * NEW_SIZE_IN_GB / EXISTING_SIZE_IN_GB\n\u003cspan class=\"m\"\u003e487981391\u003c/span\u003e * \u003cspan class=\"m\"\u003e200\u003c/span\u003e.7 / \u003cspan class=\"m\"\u003e232\u003c/span\u003e.7   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e420876085\u003c/span\u003e\n\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e487981391\u003c/span\u003e - \u003cspan class=\"m\"\u003e15\u003c/span\u003e*1024*1024*2 \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e456524111\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\ncryptsetup -b \u003cspan class=\"m\"\u003e420876085\u003c/span\u003e resize cryptlvm\n\n\u003cspan class=\"o\"\u003e(\u003c/span\u003ecryptsetup status cryptlvm\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\nparted /dev/sda\n\nresize\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","text":" How to manually boot/recover a system with LUKS and LVM I have been using LVM on top of LUKS for more than 2 years without problems. However since I haven\u0026rsquo;t had the chance to troubleshoot these technologies in the past I was quite concerned of what would happen when I would have problems. Today my main computer didn\u0026rsquo;t boot up and I had to fix it manually. This post shows the steps I performed to recover my system.\nIntro cryptsetup luksOpen /dev/sda2 cryptlvm e2fsck -f /dev/mapper/storage-home resize2fs -p /dev/mapper/storage-home 200g e2fsck -f /dev/mapper/storage-home (lvdisplay) lvreduce -L -15.68G /dev/storage/home (lvdisplay) [lvresize -l +100%FREE /dev/storate/root] e2fsck -f /dev/mapper/storage-root resize2fs /dev/mapper/storage-root cryptsetup luksClose /dev/sda2 cryptlvm ### NOT NEEDED (pvdisplay) pvresize --sephysicalvolumesize 218G /dev/mapper/cryptlvm /dev/mapper/cryptlvm is active and is in use type: LUKS1 cipher: aes-xts-plain64 keysize: 256 bits device: /dev/sda2 offset: 4096 sectors size: 487981391 sectors mode: read/write NEW_SECTORS = EXISTING_SECTORS * NEW_SIZE_IN_GB / EXISTING_SIZE_IN_GB 487981391 * 200.7 / 232.7 = 420876085 (487981391 - 15*1024*1024*2 = 456524111) cryptsetup -b 420876085 resize cryptlvm (cryptsetup status cryptlvm) parted /dev/sda resize"},"name":"Resizing lvm on luks","published":"2015-11-01T00:00:00-02:00","summary":"How to manually boot/recover a system with LUKS and LVM I have been using LVM on top of LUKS for more than 2 years without problems. However since I haven\u0026rsquo;t had the chance to troubleshoot these technologies in the past I was quite concerned of what would happen when I would have problems. Today my main computer didn\u0026rsquo;t boot up and I had to fix it manually. This post shows the steps I performed to recover my system.","type":"entry","url":"https://albertdelafuente.com/posts/20220109211911-resizing_lvm_on_luks/"}],"name":"system","type":"feed","url":"https://albertdelafuente.com/tags/system/"}